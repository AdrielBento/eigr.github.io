---
title: entity.proto
hide_title: true
---

import { ProtoMessage, ProtoServiceMethod, ProtoEnum } from '@theme/ProtoFile';

## `entity.proto`
_**path** cloudstate/entity.proto_

_**package** cloudstate_



---

## Messages


### `ClientAction`
<ProtoMessage key={0} message={{"name":"ClientAction","longName":"ClientAction","fullName":"cloudstate.ClientAction","description":"An action for the client","hasExtensions":false,"hasFields":true,"hasOneofs":true,"extensions":[],"fields":[{"name":"reply","description":"Send a reply","label":"","type":"Reply","longType":"Reply","fullType":"cloudstate.Reply","ismap":false,"isoneof":true,"oneofdecl":"action","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#reply"},{"name":"forward","description":"Forward to another entity","label":"","type":"Forward","longType":"Forward","fullType":"cloudstate.Forward","ismap":false,"isoneof":true,"oneofdecl":"action","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#forward"},{"name":"failure","description":"Send a failure to the client","label":"","type":"Failure","longType":"Failure","fullType":"cloudstate.Failure","ismap":false,"isoneof":true,"oneofdecl":"action","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#failure"}]}} />


### `Command`
<ProtoMessage key={1} message={{"name":"Command","longName":"Command","fullName":"cloudstate.Command","description":"A command. For each command received, a reply must be sent with a matching command id.","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"entity_id","description":"The ID of the entity.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"id","description":"A command id.","label":"","type":"int64","longType":"int64","fullType":"int64","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"name","description":"Command name","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"payload","description":"The command payload.","label":"","type":"Any","longType":"google.protobuf.Any","fullType":"google.protobuf.Any","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"streamed","description":"Whether the command is streamed or not.","label":"","type":"bool","longType":"bool","fullType":"bool","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"metadata","description":"The command metadata.\n\nNot all transports support per message metadata, for example, gRPC doesn't. The Cloudstate proxy MAY include\nmetadata from other locations in this case, for example, in gRPC, a unary call MAY have the HTTP request headers\nattached to the command, while a streamed call MAY have the HTTP request headers attached as the metadata for\neither the first command, or every command. This specification leaves this behavior undefined.","label":"","type":"Metadata","longType":"Metadata","fullType":"cloudstate.Metadata","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#metadata"}]}} />


### `Entity`
<ProtoMessage key={2} message={{"name":"Entity","longName":"Entity","fullName":"cloudstate.Entity","description":"","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"entity_type","description":"The type of entity. By convention, this should be a fully qualified entity protocol grpc\nservice name, for example, cloudstate.eventsourced.EventSourced.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"service_name","description":"The name of the service to load from the protobuf file.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"persistence_id","description":"The ID to namespace state by. How this is used depends on the type of entity, for example,\nevent sourced entities will prefix this to the persistence id.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"passivation_strategy","description":"The passivation strategy for the entity.","label":"","type":"EntityPassivationStrategy","longType":"EntityPassivationStrategy","fullType":"cloudstate.EntityPassivationStrategy","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#entitypassivationstrategy"}]}} />


### `EntityPassivationStrategy`
<ProtoMessage key={3} message={{"name":"EntityPassivationStrategy","longName":"EntityPassivationStrategy","fullName":"cloudstate.EntityPassivationStrategy","description":"The semantics is to provide a flexible way for entity user functions to configure the passivation strategy.\nThis strategy is sent to the proxy at discovery time allowing the proxy to configure the corresponding entities.\nThe only passivation strategy supported is the timeout strategy and configuring this is optional for the entity.\nIf an entity user function does not configure the passivation strategy the proxy uses its fallback default value.\n\nThe passivation strategy for the entity user function.","hasExtensions":false,"hasFields":true,"hasOneofs":true,"extensions":[],"fields":[{"name":"timeout","description":"the timeout passivation strategy.","label":"","type":"TimeoutPassivationStrategy","longType":"TimeoutPassivationStrategy","fullType":"cloudstate.TimeoutPassivationStrategy","ismap":false,"isoneof":true,"oneofdecl":"strategy","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#timeoutpassivationstrategy"}]}} />


### `EntitySpec`
<ProtoMessage key={4} message={{"name":"EntitySpec","longName":"EntitySpec","fullName":"cloudstate.EntitySpec","description":"","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"proto","description":"This should be the Descriptors.FileDescriptorSet in proto serialized from as generated by:\nprotoc --include_imports \\\n--proto_path=<proto file directory> \\\n--descriptor_set_out=user-function.desc \\\n<path to .proto files>","label":"","type":"bytes","longType":"bytes","fullType":"bytes","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"entities","description":"The entities being served.","label":"repeated","type":"Entity","longType":"Entity","fullType":"cloudstate.Entity","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#entity"},{"name":"service_info","description":"Optional information about the service.","label":"","type":"ServiceInfo","longType":"ServiceInfo","fullType":"cloudstate.ServiceInfo","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#serviceinfo"}]}} />


### `Failure`
<ProtoMessage key={5} message={{"name":"Failure","longName":"Failure","fullName":"cloudstate.Failure","description":"A failure reply. If this is returned, it will be translated into a gRPC unknown\nerror with the corresponding description if supplied.","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"command_id","description":"The id of the command being replied to. Must match the input command.","label":"","type":"int64","longType":"int64","fullType":"int64","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"description","description":"A description of the error.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"restart","description":"Whether this failure should trigger an entity restart.","label":"","type":"bool","longType":"bool","fullType":"bool","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""}]}} />


### `Forward`
<ProtoMessage key={6} message={{"name":"Forward","longName":"Forward","fullName":"cloudstate.Forward","description":"Forwards handling of this request to another entity.","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"service_name","description":"The name of the service to forward to.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"command_name","description":"The name of the command.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"payload","description":"The payload.","label":"","type":"Any","longType":"google.protobuf.Any","fullType":"google.protobuf.Any","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"metadata","description":"The metadata to include with the forward","label":"","type":"Metadata","longType":"Metadata","fullType":"cloudstate.Metadata","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#metadata"}]}} />


### `Metadata`
<ProtoMessage key={7} message={{"name":"Metadata","longName":"Metadata","fullName":"cloudstate.Metadata","description":"Transport-specific metadata associated with a message.\n\nThe semantics of the metadata are not defined in this protocol, but rather, depend on the transport on which a\nparticular instance of the metadata maps to. What keys or values are allowed or disallowed, whether duplicate values\nfor the same key are allowed and how they are handled, and whether key names are case sensitive or not, are all\nundefined in the context of the Cloudstate protocol.\n\nIf a metadata entry associated with a message can't be expressed in an underlying transport, for example, due to\ninvalid characters in a key or value, the behavior of the proxy is undefined. This is because metadata is transport\nspecific, so if the user function chooses to use metadata, it is choosing to be specific to a particular transport,\nwhich is beyond the scope of the Cloudstate protocol, and it's therefore the user function's responsibility to adhere\nto the semantics of that transport. The proxy MAY decide to drop metadata entries if it knows they are invalid or\nunsupported. If a metadata entry is dropped, the proxy MAY inform the user function that the entry was dropped by\nsending an error message to the EntityDiscovery.ReportError gRPC call.\n\nThe metadata MAY also contain CloudEvent metadata. If a message comes from a Cloudstate event source, the Cloudstate\nproxy MUST attach CloudEvent metadata to it if the event doesn't already have CloudEvent metadata attached to it.\nThis metadata SHALL be encoded according to the binary mode of the CloudEvent HTTP protocol binding, which can be\nfound here:\n\nhttps://github.com/cloudevents/spec/blob/master/http-protocol-binding.md\n\nThe Cloudstate proxy MAY synthesize appropriate values for Cloudstate metadata if no equivalent metadata exists in\nthe event source, for example, if there is no type, the Cloudstate proxy MAY use the name of the gRPC message as the\nCloudEvent type, and if there is no source, the Cloudstate proxy MAY use the name of the topic as the source.\n\nIf an incoming message does have CloudEvent metadata attached to it, the Cloudstate proxy MUST transcode that\nCloudEvent metadata to the HTTP protocol binding as described above.\n\nMessages sent from the user function to an event destination MAY include CloudEvent metadata. If they include any\nCloudEvent metadata, they MUST include all required CloudEvent attributes, including id, source, specversion and\ntype. The behavior of the proxy is undefined if some of these attributes, but not others, are included - the proxy\nMAY ignore them all, or MAY generate values itself, but SHOULD NOT fail sending the message. If the destination for\nthe message is an event destination, the Cloudstate proxy MUST transcode the supplied Cloudstate metadata to a\nbinding appropriate for the underlying transport for that event destination, it MUST NOT pass the CloudEvent\nmetadata as is unless the transport uses the same binding rules.","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"entries","description":"The metadata entries.","label":"repeated","type":"MetadataEntry","longType":"MetadataEntry","fullType":"cloudstate.MetadataEntry","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#metadataentry"}]}} />


### `MetadataEntry`
<ProtoMessage key={8} message={{"name":"MetadataEntry","longName":"MetadataEntry","fullName":"cloudstate.MetadataEntry","description":"A metadata entry.","hasExtensions":false,"hasFields":true,"hasOneofs":true,"extensions":[],"fields":[{"name":"key","description":"Key for the entry. Valid keys depend on the transport from or to which this metadata is sent.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"string_value","description":"A string value. Valid values depend on the transport from or which this metadata is sent.\n\nIf the transport does not support string values, the behavior of the Cloudstate proxy is undefined from the\npoint of view of this protocol. If there is a convention in the protocol for encoding string values as\nUTF-8 bytes, then the Cloudstate proxy MAY do that.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":true,"oneofdecl":"value","defaultValue":""},{"name":"bytes_value","description":"A bytes value. Valid values depend on the transport from or which this metadata is sent.\n\nIf the transport does not support bytes values, the behavior of the Cloudstate proxy is undefined from the\npoint of view of this protocol. If there is a convention in the protocol for encoding bytes values as\nBase64 encoded strings, then the Cloudstate proxy MAY do that.","label":"","type":"bytes","longType":"bytes","fullType":"bytes","ismap":false,"isoneof":true,"oneofdecl":"value","defaultValue":""}]}} />


### `ProxyInfo`
<ProtoMessage key={9} message={{"name":"ProxyInfo","longName":"ProxyInfo","fullName":"cloudstate.ProxyInfo","description":"","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"protocol_major_version","description":"","label":"","type":"int32","longType":"int32","fullType":"int32","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"protocol_minor_version","description":"","label":"","type":"int32","longType":"int32","fullType":"int32","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"proxy_name","description":"","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"proxy_version","description":"","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"supported_entity_types","description":"","label":"repeated","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""}]}} />


### `Reply`
<ProtoMessage key={10} message={{"name":"Reply","longName":"Reply","fullName":"cloudstate.Reply","description":"A reply to the sender.","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"payload","description":"The reply payload","label":"","type":"Any","longType":"google.protobuf.Any","fullType":"google.protobuf.Any","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"metadata","description":"Metadata for the reply\n\nNot all transports support per message metadata, for example, gRPC doesn't. The Cloudstate proxy MAY ignore the\nmetadata in this case, or it MAY lift the metadata into another place, for example, in gRPC, a unary call MAY\nhave its reply metadata placed in the headers of the HTTP response, or the first reply to a streamed call MAY\nhave its metadata placed in the headers of the HTTP response.\n\nIf the metadata is ignored, the Cloudstate proxy MAY notify the user function by sending an error message to the\nEntityDiscovery.ReportError gRPC call.","label":"","type":"Metadata","longType":"Metadata","fullType":"cloudstate.Metadata","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#metadata"}]}} />


### `ServiceInfo`
<ProtoMessage key={11} message={{"name":"ServiceInfo","longName":"ServiceInfo","fullName":"cloudstate.ServiceInfo","description":"Information about the service that proxy is proxying to.\nAll of the information in here is optional. It may be useful for debug purposes.","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"service_name","description":"The name of the service, eg, \"shopping-cart\".","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"service_version","description":"The version of the service.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"service_runtime","description":"A description of the runtime for the service. Can be anything, but examples might be:\n- node v10.15.2\n- OpenJDK Runtime Environment 1.8.0_192-b12","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"support_library_name","description":"If using a support library, the name of that library, eg \"cloudstate\"","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"support_library_version","description":"The version of the support library being used.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"protocol_major_version","description":"Cloudstate protocol major version accepted by the support library.","label":"","type":"int32","longType":"int32","fullType":"int32","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"protocol_minor_version","description":"Cloudstate protocol minor version accepted by the support library.","label":"","type":"int32","longType":"int32","fullType":"int32","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""}]}} />


### `SideEffect`
<ProtoMessage key={12} message={{"name":"SideEffect","longName":"SideEffect","fullName":"cloudstate.SideEffect","description":"A side effect to be done after this command is handled.","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"service_name","description":"The name of the service to perform the side effect on.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"command_name","description":"The name of the command.","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"payload","description":"The payload of the command.","label":"","type":"Any","longType":"google.protobuf.Any","fullType":"google.protobuf.Any","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"synchronous","description":"Whether this side effect should be performed synchronously, ie, before the reply is eventually\nsent, or not.","label":"","type":"bool","longType":"bool","fullType":"bool","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"metadata","description":"The metadata to include with the side effect","label":"","type":"Metadata","longType":"Metadata","fullType":"cloudstate.Metadata","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":"","typeLink":"/protodocs/cloudstate/entity.proto#metadata"}]}} />


### `StreamCancelled`
<ProtoMessage key={13} message={{"name":"StreamCancelled","longName":"StreamCancelled","fullName":"cloudstate.StreamCancelled","description":"","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"entity_id","description":"The ID of the entity","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""},{"name":"id","description":"The command id","label":"","type":"int64","longType":"int64","fullType":"int64","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""}]}} />


### `TimeoutPassivationStrategy`
<ProtoMessage key={14} message={{"name":"TimeoutPassivationStrategy","longName":"TimeoutPassivationStrategy","fullName":"cloudstate.TimeoutPassivationStrategy","description":"A passivation strategy based on a timeout. The idle timeout after which a user function's entity is passivated.","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"timeout","description":"The timeout in millis","label":"","type":"int64","longType":"int64","fullType":"int64","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""}]}} />


### `UserFunctionError`
<ProtoMessage key={15} message={{"name":"UserFunctionError","longName":"UserFunctionError","fullName":"cloudstate.UserFunctionError","description":"","hasExtensions":false,"hasFields":true,"hasOneofs":false,"extensions":[],"fields":[{"name":"message","description":"","label":"","type":"string","longType":"string","fullType":"string","ismap":false,"isoneof":false,"oneofdecl":"","defaultValue":""}]}} />

---
## Services


### `EntityDiscovery`

Entity discovery service.


#### `discover`
<ProtoServiceMethod key={'discover-0'} method={{"name":"discover","description":"Discover what entities the user function wishes to serve.","requestType":"ProxyInfo","requestLongType":"ProxyInfo","requestFullType":"cloudstate.ProxyInfo","requestStreaming":false,"responseType":"EntitySpec","responseLongType":"EntitySpec","responseFullType":"cloudstate.EntitySpec","responseStreaming":false,"requestTypeLink":"/protodocs/cloudstate/entity.proto#proxyinfo","responseTypeLink":"/protodocs/cloudstate/entity.proto#entityspec"}} />


#### `reportError`
<ProtoServiceMethod key={'reportError-1'} method={{"name":"reportError","description":"Report an error back to the user function. This will only be invoked to tell the user function\nthat it has done something wrong, eg, violated the protocol, tried to use an entity type that\nisn't supported, or attempted to forward to an entity that doesn't exist, etc. These messages\nshould be logged clearly for debugging purposes.","requestType":"UserFunctionError","requestLongType":"UserFunctionError","requestFullType":"cloudstate.UserFunctionError","requestStreaming":false,"responseType":"Empty","responseLongType":".google.protobuf.Empty","responseFullType":"google.protobuf.Empty","responseStreaming":false,"requestTypeLink":"/protodocs/cloudstate/entity.proto#userfunctionerror"}} />


---


  